## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              AWS REGION (us-east-1)                             │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                           VPC (10.0.0.0/16)                               │  │
│  │                                                                           │  │
│  │   ┌─────────────────────────────────────────────────────────────────┐     │  │
│  │   │                    AVAILABILITY ZONE A                          │     │  │
│  │   │  ┌─────────────────────┐      ┌─────────────────────┐           │     │  │
│  │   │  │   PUBLIC SUBNET     │      │   PRIVATE SUBNET    │           │     │  │
│  │   │  │   10.0.1.0/24       │      │   10.0.10.0/24      │           │     │  │
│  │   │  │                     │      │                     │           │     │  │
│  │   │  │  ┌───────────────┐  │      │  ┌───────────────┐  │           │     │  │
│  │   │  │  │  NAT Gateway  │──┼──────┼─▶│  App Servers  │  │           │     │  │
│  │   │  │  └───────────────┘  │      │  └───────────────┘  │           │     │  │
│  │   │  │                     │      │  ┌───────────────┐  │           │     │  │
│  │   │  │                     │      │  │   Databases   │  │           │     │  │
│  │   │  │                     │      │  └───────────────┘  │           │     │  │
│  │   │  └─────────────────────┘      └─────────────────────┘           │     │  │
│  │   └─────────────────────────────────────────────────────────────────┘     │  │
│  │                                                                           │  │
│  │   ┌─────────────────────────────────────────────────────────────────┐     │  │
│  │   │                    AVAILABILITY ZONE B                          │     │  │
│  │   │  ┌─────────────────────┐      ┌─────────────────────┐           │     │  │
│  │   │  │   PUBLIC SUBNET     │      │   PRIVATE SUBNET    │           │     │  │
│  │   │  │   10.0.2.0/24       │      │   10.0.20.0/24      │           │     │  │
│  │   │  │                     │      │                     │           │     │  │
│  │   │  │  ┌───────────────┐  │      │  ┌───────────────┐  │           │     │  │
│  │   │  │  │  NAT Gateway  │──┼──────┼─▶│  App Servers  │  │          │     │  │
│  │   │  │  └───────────────┘  │      │  └───────────────┘  │           │     │  │
│  │   │  └─────────────────────┘      └─────────────────────┘           │     │  │
│  │   └─────────────────────────────────────────────────────────────────┘     │  │
│  │                                                                           │  │
│  │   ┌─────────────────────────────────────────────────────────────────┐     │  │
│  │   │                      DATA SUBNET TIER                           │     │  │
│  │   │  ┌─────────────────────┐      ┌─────────────────────┐           │     │  │
│  │   │  │   DATA SUBNET A     │      │   DATA SUBNET B     │           │     │  │
│  │   │  │   10.0.100.0/24     │      │   10.0.200.0/24     │           │     │  │
│  │   │  │   (No NAT access)   │      │   (No NAT access)   │           │     │  │
│  │   │  └─────────────────────┘      └─────────────────────┘           │     │  │
│  │   └─────────────────────────────────────────────────────────────────┘     │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                 │
│       ┌─────────────┐                                                           │
│       │   Internet  │                                                           │
│       │   Gateway   │◀──── Public internet access                               │
│       └─────────────┘                                                           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Traffic Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           NETWORK TRAFFIC FLOWS                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

INBOUND (User Request):
═══════════════════════

    Internet
       │
       ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Internet   │────▶│     ALB      │────▶│  App Server │────▶│   Database   │
│   Gateway    │     │  (Public)    │     │  (Private)   │     │    (Data)    │
└──────────────┘     └──────────────┘     └──────────────┘     └──────────────┘
                           │                    │                     │
                           ▼                    ▼                     ▼
                     SG: 443 only         SG: ALB only          SG: App only
                     from internet        on port 8080          on port 5432


OUTBOUND (Server Updates):
══════════════════════════

┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  App Server  │────▶│ NAT Gateway  │────▶│   Internet  │
│  (Private)   │     │  (Public)    │     │   Gateway    │──────▶ Internet
└──────────────┘     └──────────────┘     └──────────────┘

    Route table:                Route table:
    0.0.0.0/0 → NAT             0.0.0.0/0 → IGW


DATA TIER (Isolated):
═════════════════════

┌──────────────┐     ┌──────────────┐
│   Database   │  ✗  │   Internet   │    NO outbound internet access
│   (Data)     │─────│              │    Must use VPC endpoints for
└──────────────┘     └──────────────┘    AWS service access
```

## Security Layers

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        DEFENSE IN DEPTH LAYERS                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

     LAYER 1: Network ACLs (Subnet Level - Stateless)
     ═════════════════════════════════════════════════
     ┌─────────────────────────────────────────────────────────────────┐
     │  NACL: Default deny + explicit allows                           │
     │  • Inbound: Allow 443 from 0.0.0.0/0 to public subnets          │
     │  • Inbound: Allow ephemeral ports for return traffic            │
     │  • Outbound: Allow all to 0.0.0.0/0 (stateless, need return)    │
     └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     LAYER 2: Security Groups (Instance Level - Stateful)
     ═════════════════════════════════════════════════════
     ┌─────────────────────────────────────────────────────────────────┐
     │  SG: Reference other SGs, not CIDR blocks                       │
     │                                                                 │
     │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐          │
     │  │   ALB-SG    │───▶│   App-SG    │──▶│   DB-SG     │          │
     │  │ In: 443/any │    │ In: 8080    │    │ In: 5432    │          │
     │  │             │    │    from     │    │    from     │          │
     │  │             │    │   ALB-SG    │    │   App-SG    │          │
     │  └─────────────┘    └─────────────┘    └─────────────┘          │
     └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     LAYER 3: Host-Based Controls (OS Level)
     ═════════════════════════════════════════
     ┌─────────────────────────────────────────────────────────────────┐
     │  • iptables/nftables on Linux                                   │
     │  • Application-level authentication                             │
     │  • TLS everywhere                                               │
     └─────────────────────────────────────────────────────────────────┘
```

### Route Tables

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            ROUTE TABLE DESIGN                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

PUBLIC ROUTE TABLE:                    PRIVATE ROUTE TABLE:
══════════════════                     ═══════════════════
┌────────────────────────────┐         ┌────────────────────────────┐
│ Destination │    Target    │         │ Destination │    Target    │
├─────────────┼──────────────┤         ├─────────────┼──────────────┤
│ 10.0.0.0/16 │    local     │         │ 10.0.0.0/16 │    local     │
│ 0.0.0.0/0   │    igw-xxx   │         │ 0.0.0.0/0   │   nat-xxx    │
└────────────────────────────┘         └────────────────────────────┘
      │                                       │
      │ Internet access                       │ Updates, external APIs
      ▼                                       ▼

DATA ROUTE TABLE:
═════════════════
┌────────────────────────────┐
│ Destination │    Target    │
├─────────────┼──────────────┤
│ 10.0.0.0/16 │    local     │
│             │ (NO DEFAULT) │◄── No internet route!
└────────────────────────────┘
      │
      │ VPC Endpoints for AWS services
      ▼
```

### VPC Flow Logs

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           VPC FLOW LOGS ARCHITECTURE                            │
└─────────────────────────────────────────────────────────────────────────────────┘

     ┌─────────────┐
     │    VPC      │
     │  (Source)   │
     └──────┬──────┘
            │
            │ All traffic metadata
            ▼
     ┌─────────────┐         ┌─────────────┐         ┌─────────────┐
     │  Flow Logs  │────────▶│ CloudWatch  │───────▶│   Alerts    │
     │             │         │    Logs     │         │  (Anomaly)  │
     └─────────────┘         └─────────────┘         └─────────────┘

